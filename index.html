<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scanner de Valijas - Web</title>
  <style>
    :root{
      --bg:#0f172a;
      --panel:#111827;
      --card:#1f2937;
      --muted:#9ca3af;
      --accent:#22c55e;
      --accent-2:#f59e0b;
      --danger:#ef4444;
      --ring:#3b82f6;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans";background:var(--bg);color:#fff}
    header{position:sticky;top:0;z-index:30;background:linear-gradient(180deg, rgba(17,24,39,0.95), rgba(17,24,39,0.8));backdrop-filter: blur(8px);border-bottom:1px solid #1f2937}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    h1{font-size:1.25rem;margin:0;display:flex;align-items:center;gap:.5rem}
    .badge{font-size:.75rem;padding:.15rem .5rem;border:1px solid #374151;border-radius:.5rem;color:#d1d5db}
    nav.menu {
      display: none;
      flex-direction: column;
      gap: 4px;
      padding: 8px 16px;
      background:#111827;
      border-bottom:1px solid #1f2937;
    }
    nav.menu.show { display: flex; }
    nav.menu .tab { width:100%; text-align:left; }
    main{padding:16px}
    .grid{display:grid;gap:16px}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:900px){.grid.cols-2{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #374151;border-radius:16px;overflow:hidden}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid #374151;font-size:1rem}
    .card .body{padding:16px}
    label{display:block;font-size:.9rem;margin:8px 0 4px;color:#e5e7eb}
    input,select,textarea,button{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
    input:focus,select:focus,textarea:focus{outline:2px solid var(--ring);border-color:transparent}
    button{cursor:pointer}
    .btn{padding:10px 12px;border:1px solid #374151;background:#111827;border-radius:12px;color:#e5e7eb}
    .btn.primary{background:var(--ring);border-color:transparent;color:white}
    .btn.success{background:var(--accent);border-color:transparent;color:#052e16}
    .btn.danger{background:var(--danger);border-color:transparent;color:#fff}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #374151;padding:8px;text-align:left;font-size:.92rem}
    th{color:#cbd5e1;font-weight:600}
    tr.dup td{background:rgba(245,158,11,0.08)}
    tr.err td{background:rgba(239,68,68,0.08)}
    .camera{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;border:1px solid #374151}
    .footer{padding:16px;text-align:center;color:#94a3b8}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center">
      <h1>üß≥ Scanner de Valijas <span class="badge">Web</span></h1>
      <button id="menuToggle" class="btn" style="width:auto;padding:6px 10px;font-size:1.2rem">‚ò∞</button>
    </div>
    <nav id="tabs" class="menu">
      <button class="tab active" data-tab="escaneo">Escaneo</button>
      <button class="tab" data-tab="vuelos">Vuelos</button>
      <button class="tab" data-tab="historial">Historial</button>
      <button class="tab" data-tab="exportar">Exportar / Herramientas</button>
      <button class="tab" data-tab="ayuda">Ayuda</button>
    </nav>
  </header>

  <main class="container">
    <!-- üîπ Escaneo -->
    <section id="escaneo" class="grid cols-2">
      <div class="card">
        <h2>üì∑ Escanear</h2>
        <div class="body">
          <div class="camera" id="cameraPreview"></div>
          <input id="scanInput" placeholder="Escanear c√≥digo..." autofocus />
          <div style="margin-top:8px"><label><input type="checkbox" id="chkAudio"> Sonido</label></div>
        </div>
      </div>
      <div class="card">
        <h2>üìã √öltimos escaneos</h2>
        <div class="body"><ul id="scanList"></ul></div>
      </div>
    </section>

    <!-- üîπ Vuelos -->
    <section id="vuelos" style="display:none" class="grid cols-2">
      <div class="card"><h2>‚úàÔ∏è Crear vuelo</h2>
        <div class="body">
          <input id="vueloCodigo" placeholder="C√≥digo de vuelo">
          <button class="btn primary" id="btnNuevoVuelo">Crear vuelo</button>
        </div>
      </div>
      <div class="card"><h2>üõ´ Activos</h2><div class="body"><ul id="vueloList"></ul></div></div>
    </section>

    <!-- üîπ Historial -->
    <section id="historial" style="display:none" class="grid cols-2">
      <div class="card"><h2>üìë Escaneos</h2><div class="body"><table><thead><tr><th>C√≥digo</th><th>Vuelo</th><th>Hora</th></tr></thead><tbody id="histTable"></tbody></table></div></div>
    </section>

    <!-- üîπ Exportar -->
    <section id="exportar" style="display:none" class="grid cols-2">
      <div class="card"><h2>üì§ Exportar</h2><div class="body"><button class="btn success" id="btnExport">Exportar JSON</button></div></div>
    </section>

    <!-- üîπ Ayuda -->
    <section id="ayuda" style="display:none" class="grid cols-2">
      <div class="card"><h2>‚ÑπÔ∏è Ayuda</h2><div class="body">App de prueba para escaneo de valijas con c√°mara del m√≥vil.</div></div>
    </section>

    <div class="footer">v1.0 ‚Ä¢ MVP local ‚Ä¢ Hecho para flujo de escaneo √°gil</div>
  </main>

  <audio id="beepOk" preload="auto"><source src="data:audio/wav;base64,UklGRoYAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBHGZmZmZmZmY=" type="audio/wav"></audio>
  <audio id="beepErr" preload="auto"><source src="data:audio/wav;base64,UklGRoYAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBHGZmZmZmZmY=" type="audio/wav"></audio>

  <script>
  // ------------------ Persistencia ------------------
  const DB_KEY='scannerValijasDB.v1';
  const db={load(){try{return JSON.parse(localStorage.getItem(DB_KEY))||{vuelos:[],scans:[],active:null}}catch(e){return{vuelos:[],scans:[],active:null}}},save(d){localStorage.setItem(DB_KEY,JSON.stringify(d))}};
  let state=db.load();
  const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
  const fmtDateTime=iso=>new Date(iso).toLocaleString();
  const play=ok=>{if(!$('#chkAudio')?.checked)return;(ok?$('#beepOk'):$('#beepErr')).currentTime=0;(ok?$('#beepOk'):$('#beepErr')).play().catch(()=>{})};

  // ------------------ Men√∫ ------------------
  $('#menuToggle').addEventListener('click',e=>{e.stopPropagation();$('#tabs').classList.toggle('show')});
  document.addEventListener('click',e=>{
    const menu=$('#tabs'),toggle=$('#menuToggle');
    if(menu.classList.contains('show') && !menu.contains(e.target) && !toggle.contains(e.target)){menu.classList.remove('show')}
  });
  $$('#tabs .tab').forEach(btn=>btn.addEventListener('click',()=>{
    $$('#tabs .tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    ['escaneo','vuelos','historial','exportar','ayuda'].forEach(id=>$('#'+id).style.display='none');
    $('#'+btn.dataset.tab).style.display='grid';
    if(btn.dataset.tab==='escaneo'){$('#scanInput')?.focus()}
    $('#tabs').classList.remove('show');
  }));

  // ------------------ Funcionalidad ------------------
  function render(){ // render b√°sico de listas
    $('#scanList').innerHTML=state.scans.slice(-5).map(s=>`<li>${s.code} (${s.vuelo||'‚Äì'})</li>`).join('');
    $('#vueloList').innerHTML=state.vuelos.map(v=>`<li>${v}</li>`).join('');
    $('#histTable').innerHTML=state.scans.map(s=>`<tr><td>${s.code}</td><td>${s.vuelo||''}</td><td>${fmtDateTime(s.time)}</td></tr>`).join('');
  }

  $('#scanInput').addEventListener('keydown',e=>{
    if(e.key==='Enter'){const code=e.target.value.trim();if(!code)return;
      const s={code,time:new Date().toISOString(),vuelo:state.active};state.scans.push(s);
      db.save(state);render();play(true);e.target.value='';}
  });

  $('#btnNuevoVuelo').onclick=()=>{
    const v=$('#vueloCodigo').value.trim();if(!v)return;state.vuelos.push(v);state.active=v;db.save(state);render();
  };

  $('#btnExport').onclick=()=>{
    const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
    const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='valijas.json';a.click();
  };

  render();
  </script>
</body>
</html>
